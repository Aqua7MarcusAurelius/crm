# üè¢ CRM System

–°–∞–º–æ–ø–∏—Å–Ω–∞—è CRM-—Å–∏—Å—Ç–µ–º–∞ —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é. Self-hosted, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±–ª–∞—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π (–∑–∞—è–≤–∫–∞ ‚Üí –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–º ‚Üí –¥–æ—Å—Ç—É–ø)
- JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–º–∏—à–µ–Ω–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
- –û–¥–æ–±—Ä–µ–Ω–∏–µ / –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ / –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ / –∞–∫—Ç–∏–≤–∞—Ü–∏—è
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ email —á–µ—Ä–µ–∑ –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏
- –î–æ–ª–∂–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É

### –ö–ª–∏–µ–Ω—Ç—ã
- –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞: 22 –ø–æ–ª—è (–∫–æ–Ω—Ç–∞–∫—Ç—ã, Telegram, –ª–æ–∫–∞—Ü–∏—è, –¥–æ–ø. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
- –°–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ
- –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É, email, Telegram
- **–ü–∞–∫–µ—Ç–Ω—ã–π –∏–º–ø–æ—Ä—Ç** –∏–∑ CSV —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –∏ –æ—Ç—á—ë—Ç–æ–º –æ–± –æ—à–∏–±–∫–∞—Ö
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ CSV-—à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

---

## üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

### Backend
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| **NestJS** | 11.x | API-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| **Prisma** | 7.x | ORM |
| **PostgreSQL** | 16 | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î |
| **Redis** | 7 | –ö–µ—à –∏ –æ—á–µ—Ä–µ–¥–∏ |
| **Zod** | 4.x | –í–∞–ª–∏–¥–∞—Ü–∏—è |
| **JWT + Passport** | ‚Äî | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |

### Frontend
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|
| **Next.js** | 16.x | React-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| **Tailwind CSS** | v4 | –°—Ç–∏–ª–∏ |
| **shadcn/ui** | ‚Äî | UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã |
| **Zustand** | ‚Äî | –°—Ç–µ–π—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç |

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| **Docker Compose** | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ |
| **MinIO** | S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |
| **Ubuntu 24.04** | –°–µ—Ä–≤–µ—Ä–Ω–∞—è –û–° |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
crm/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, JWT, –≥–∞—Ä–¥—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users/          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/        # CRUD –∫–ª–∏–µ–Ω—Ç–æ–≤, –∏–º–ø–æ—Ä—Ç CSV
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prisma/         # –°–µ—Ä–≤–∏—Å –ë–î
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common/         # –ü–∞–π–ø—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ prisma/
‚îÇ       ‚îî‚îÄ‚îÄ schema.prisma   # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ app/            # –°—Ç—Ä–∞–Ω–∏—Ü—ã (login, register, users, clients)
‚îÇ       ‚îú‚îÄ‚îÄ components/     # Sidebar, UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ lib/            # API-–∫–ª–∏–µ–Ω—Ç, auth store
‚îú‚îÄ‚îÄ docs/                   # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ start.sh / stop.sh
‚îî‚îÄ‚îÄ .env
```

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```
User ‚îÄ‚îÄ‚Üí Project (–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç)
 ‚îÇ ‚îÄ‚îÄ‚Üí Position (–¥–æ–ª–∂–Ω–æ—Å—Ç—å)
 ‚îÇ ‚îÄ‚îÄ‚Üí CorporateEmail (–∫–æ—Ä–ø. –ø–æ—á—Ç–∞, one-to-one)
 ‚îÇ ‚Üê‚Üí Permission (many-to-many —á–µ—Ä–µ–∑ UserPermission)
 ‚îî‚îÄ‚îÄ‚Üí Client (created_by)

Client ‚Äî 22 –ø–æ–ª—è: –§–ò–û, –∫–æ–Ω—Ç–∞–∫—Ç—ã, Telegram, –ª–æ–∫–∞—Ü–∏—è, –¥–æ–ø. –∏–Ω—Ñ–æ
Project ‚îÄ‚îÄ‚Üí Position[] (–¥–æ–ª–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø—Ä–æ–µ–∫—Ç—É)
```

**Workflow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí PENDING ‚Üí –ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç ‚Üí ACTIVE
                      ‚Üí –ê–¥–º–∏–Ω –æ—Ç–∫–ª–æ–Ω—è–µ—Ç ‚Üí REJECTED
              ACTIVE ‚Üí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Üí BLOCKED
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Ubuntu 24.04 (–∏–ª–∏ –¥—Ä—É–≥–æ–π Linux)
- Docker + Docker Compose
- Node.js 24+ (—á–µ—Ä–µ–∑ nvm)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone https://github.com/Aqua7MarcusAurelius/crm.git
cd crm

# 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env        # –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏
cp backend/.env.example backend/.env  # DATABASE_URL + JWT_SECRET

# 3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
docker compose up -d

# 4. Backend
cd backend
npm install
npx prisma migrate dev
cd ..

# 5. Frontend
cd frontend
npm install
cd ..

# 6. –ó–∞–ø—É—Å–∫
./start.sh
```

### –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | URL |
|---|---|
| Frontend | http://localhost:3000 |
| Backend API | http://localhost:3001 |
| Prisma Studio | http://localhost:5555 |
| MinIO Console | http://localhost:9001 |

---

## üì° API

### Auth (–ø—É–±–ª–∏—á–Ω—ã–µ)
```
POST /auth/register    ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /auth/login       ‚Äî –õ–æ–≥–∏–Ω ‚Üí JWT
```

### Users (JWT + Admin)
```
GET    /users              ‚Äî –°–ø–∏—Å–æ–∫ (—Ñ–∏–ª—å—Ç—Ä, –ø–æ–∏—Å–∫)
GET    /users/:id          ‚Äî –î–µ—Ç–∞–ª–∏
PATCH  /users/:id          ‚Äî –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
PATCH  /users/:id/approve  ‚Äî –û–¥–æ–±—Ä–∏—Ç—å
PATCH  /users/:id/reject   ‚Äî –û—Ç–∫–ª–æ–Ω–∏—Ç—å
PATCH  /users/:id/block    ‚Äî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
PATCH  /users/:id/activate ‚Äî –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
```

### Clients (JWT + Permissions)
```
GET    /clients        ‚Äî –°–ø–∏—Å–æ–∫ (–ø–æ–∏—Å–∫)
GET    /clients/:id    ‚Äî –î–µ—Ç–∞–ª–∏
POST   /clients        ‚Äî –°–æ–∑–¥–∞—Ç—å
POST   /clients/bulk   ‚Äî –ò–º–ø–æ—Ä—Ç CSV
PATCH  /clients/:id    ‚Äî –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
DELETE /clients/:id    ‚Äî –£–¥–∞–ª–∏—Ç—å
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SSH: –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç, —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏, root –æ—Ç–∫–ª—é—á—ë–Ω
- Firewall (UFW): –æ—Ç–∫—Ä—ã—Ç—ã —Ç–æ–ª—å–∫–æ 2222, 80, 443
- Fail2ban: –±–∞–Ω –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –í—Å–µ –ø–æ—Ä—Ç—ã –ë–î –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ 127.0.0.1
- –ü–∞—Ä–æ–ª–∏ –≤ bcrypt, JWT –¥–ª—è —Å–µ—Å—Å–∏–π
- Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–µ

---

## üìã Roadmap

- [x] –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Docker, PostgreSQL, Redis, MinIO)
- [x] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, JWT)
- [x] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [x] –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–º–∏—à–µ–Ω–æ–≤
- [x] –ú–æ–¥—É–ª—å –∫–ª–∏–µ–Ω—Ç–æ–≤ + –∏–º–ø–æ—Ä—Ç CSV
- [ ] –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (seed –¥–∞–Ω–Ω—ã–µ)
- [ ] Nginx + –¥–æ–º–µ–Ω + SSL
- [ ] –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (MinIO –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- [ ] –ß–∞—Ç –º–µ–∂–¥—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ (Socket.io)
- [ ] –¢–∏–∫–µ—Ç—ã —Å —á–∞—Ç–æ–º
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- [ ] Telegram-–±–æ—Ç

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –ø–∞–ø–∫–µ [`docs/`](./docs/):

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| [STACK.md](./docs/STACK.md) | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ |
| [ARCHITECTURE.md](./docs/ARCHITECTURE.md) | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –º–æ–¥—É–ª–∏, API |
| [DATABASE.md](./docs/DATABASE.md) | –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| [CURRENT_STATE.md](./docs/CURRENT_STATE.md) | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| [TODO.md](./docs/TODO.md) | –ü–ª–∞–Ω—ã –∏ –∑–∞–¥–∞—á–∏ |
| [SETUP.md](./docs/SETUP.md) | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –Ω—É–ª—è |

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Private project.
